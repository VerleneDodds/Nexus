ubuntu@ubuntu:~$ sudo docker build Nexus/
Sending build context to Docker daemon  3.584kB
Step 1/19 : FROM docker:dind
 ---> be435b54cd39
Step 2/19 : EXPOSE 22 53 80 443 1000 2375 2376 2377 9443
 ---> Using cache
 ---> 063eff888652
Step 3/19 : VOLUME ["/var/run", "/var/lib/docker/volumes"]
 ---> Using cache
 ---> 4c009322fd4e
Step 4/19 : RUN apk update
 ---> Using cache
 ---> 79eeb78bd07f
Step 5/19 : RUN apk upgrade
 ---> Using cache
 ---> d721eff34d51
Step 6/19 : RUN apk add bash
 ---> Using cache
 ---> e6b28bde2055
Step 7/19 : RUN apk add nano
 ---> Using cache
 ---> 1384595258d5
Step 8/19 : RUN apk add curl
 ---> Using cache
 ---> 8992353dd605
Step 9/19 : RUN apk add wget
 ---> Using cache
 ---> 761388f945f9
Step 10/19 : RUN echo "#!/bin/sh" > deploy-olympiad.sh
 ---> Running in 328c6c346139
Removing intermediate container 328c6c346139
 ---> 9680d699609b
Step 11/19 : RUN echo "docker swarm init" >> deploy-olympiad.sh
 ---> Running in 6afe402cdacc
Removing intermediate container 6afe402cdacc
 ---> 7b8643a8ef83
Step 12/19 : RUN echo "apk add docker-compose" >> deploy-olympiad.sh
 ---> Running in 01aba5da1ee5
Removing intermediate container 01aba5da1ee5
 ---> 57bfe0aead8f
Step 13/19 : RUN echo "curl -s https://raw.githubusercontent.com/rancher/k3d/main/install.sh | bash" >>                                                                                                                                      deploy-olympiad.sh
 ---> Running in 71472d6cade2
Removing intermediate container 71472d6cade2
 ---> ad5ee38caabc
Step 14/19 : RUN echo "docker network create -d bridge --subnet=10.20.0.0/24 Inner-Athena" >> deploy-oly                                                                                                                                     mpiad.sh
 ---> Running in 162323c3622c
Removing intermediate container 162323c3622c
 ---> 5b0bf0950612
Step 15/19 : RUN echo "docker run -itd --privileged -p 53:53/tcp -p 53:53/udp -p 67:67 -p 80:80 -p 443:4                                                                                                                                     43 -h Inner-DNS-Control --name=Inner-DNS-Control --net=Inner-Athena --ip=10.20.0.20 --restart=always -v                                                                                                                                      pihole_DNS_data:/etc/dnsmasq.d/ -v /var/lib/docker/volumes/pihole_DNS_data/_data/pihole/:/etc/pihole/ pi                                                                                                                                     hole/pihole:latest" >> deploy-olympiad.sh
 ---> Running in 0aa8bbb06274
Removing intermediate container 0aa8bbb06274
 ---> c66a4cb91c7e
Step 16/19 : RUN echo "docker run -itd -p 22:22 -h Athena0 --name=Athena0 --dns=10.20.0.20 --net=Inner-A                                                                                                                                     thena --restart=always -v athena0:/home/ -v /etc/docker:/etc/docker -v /usr/local/bin/docker:/usr/local/                                                                                                                                     bin/docker -v /var/run/docker.sock:/var/run/docker.sock kalilinux/kali-bleeding-edge" >> deploy-olympiad                                                                                                                                     .sh
 ---> Running in 48cf992426da
Removing intermediate container 48cf992426da
 ---> 393bc98caeeb
Step 17/19 : RUN echo "docker run -d --name=workbench -h workbench --privileged --init -e PUID=1000 -e P                                                                                                                                     GID=1000 -e TZ=America/Colorado -p 1000:3000 --dns=10.20.0.20 --net=Inner-Athena -v workbench0:/config -                                                                                                                                     v /var/run/docker.sock:/var/run/docker.sock --restart unless-stopped linuxserver/webtop:ubuntu-kde" >> d                                                                                                                                     eploy-olympiad.sh
 ---> Running in c0605016a141
Removing intermediate container c0605016a141
 ---> 32b663097d98
Step 18/19 : RUN echo "docker volume create portainer_data" >> deploy-olympiad.sh
 ---> Running in 97b2298ed7ad
Removing intermediate container 97b2298ed7ad
 ---> 567476367a4f
Step 19/19 : RUN echo "docker run -d -p 8000:8000 -p 9443:9443 --name Olympiad0 --dns=10.20.0.20 --net=I                                                                                                                                     nner-Athena --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data cr.por                                                                                                                                     tainer.io/portainer/portainer-ce" >> deploy-olympiad.sh
 ---> Running in c7667f541949
Removing intermediate container c7667f541949
 ---> fdd180b1a6f9
Successfully built fdd180b1a6f9
ubuntu@ubuntu:~$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: eth0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc fq_codel state DOWN group default qlen 1000
    link/ether b8:27:eb:5d:37:08 brd ff:ff:ff:ff:ff:ff
3: wlan0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether b8:27:eb:08:62:5d brd ff:ff:ff:ff:ff:ff
    inet 192.168.19.157/24 brd 192.168.19.255 scope global dynamic wlan0
       valid_lft 363sec preferred_lft 363sec
    inet6 fe80::ba27:ebff:fe08:625d/64 scope link
       valid_lft forever preferred_lft forever
4: docker0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN group default
    link/ether 02:42:f9:15:07:02 brd ff:ff:ff:ff:ff:ff
    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0
       valid_lft forever preferred_lft forever
    inet6 fe80::42:f9ff:fe15:702/64 scope link
       valid_lft forever preferred_lft forever
ubuntu@ubuntu:~$ sudo docker image ls
REPOSITORY   TAG       IMAGE ID       CREATED              SIZE
<none>       <none>    fdd180b1a6f9   About a minute ago   234MB
<none>       <none>    98e3e7cf093d   5 minutes ago        234MB
docker       dind      be435b54cd39   3 weeks ago          216MB
ubuntu@ubuntu:~$ sudo docker run --name Nexus -t -i --privileged -p 443:443 -p 1000:1000 -p 2375:2375 -p                                                                                                                                      2376:2376 -p 2377:2377 -p 9443:9443 -v /var/run -v /var/lib/docker/volumes fdd180b1a6f9
Generating RSA private key, 4096 bit long modulus (2 primes)
......................................................................................................++                                                                                                                                     ++
........................................................................................................                                                                                                                                     .........................................++++
e is 65537 (0x010001)
Generating RSA private key, 4096 bit long modulus (2 primes)
...........++++
..........................................................................++++
e is 65537 (0x010001)
Signature ok
subject=CN = docker:dind server
Getting CA Private Key
/certs/server/cert.pem: OK
Generating RSA private key, 4096 bit long modulus (2 primes)
..............................................................++++
........................................................................................................                                                                                                                                     ..............................................................++++
e is 65537 (0x010001)
Signature ok
subject=CN = docker:dind client
Getting CA Private Key
/certs/client/cert.pem: OK
INFO[2022-02-15T02:49:33.983617282Z] Starting up
WARN[2022-02-15T02:49:34.025873069Z] could not change group /var/run/docker.sock to docker: group docker                                                                                                                                      not found
INFO[2022-02-15T02:49:34.052086252Z] libcontainerd: started new containerd process  pid=68
INFO[2022-02-15T02:49:34.052523070Z] parsed scheme: "unix"                         module=grpc
INFO[2022-02-15T02:49:34.052756349Z] scheme "unix" not registered, fallback to default scheme  module=gr                                                                                                                                     pc
INFO[2022-02-15T02:49:34.053219053Z] ccResolverWrapper: sending update to cc: {[{unix:///var/run/docker/                                                                                                                                     containerd/containerd.sock  <nil> 0 <nil>}] <nil> <nil>}  module=grpc
INFO[2022-02-15T02:49:34.053397281Z] ClientConn switching balancer to "pick_first"  module=grpc
WARN[2022-02-15T02:49:35.056480282Z] grpc: addrConn.createTransport failed to connect to {unix:///var/ru                                                                                                                                     n/docker/containerd/containerd.sock  <nil> 0 <nil>}. Err :connection error: desc = "transport: error whi                                                                                                                                     le dialing: dial unix:///var/run/docker/containerd/containerd.sock: timeout". Reconnecting...  module=gr                                                                                                                                     pc
INFO[2022-02-15T02:49:35.519776869Z] starting containerd                           revision=7b11cfaabd73                                                                                                                                     bb80907dd23182b9347b4245eb5d version=v1.4.12
INFO[2022-02-15T02:49:35.925016468Z] loading plugin "io.containerd.content.v1.content"...  type=io.conta                                                                                                                                     inerd.content.v1
INFO[2022-02-15T02:49:35.927125041Z] loading plugin "io.containerd.snapshotter.v1.aufs"...  type=io.cont                                                                                                                                     ainerd.snapshotter.v1
INFO[2022-02-15T02:49:36.005073970Z] skip loading plugin "io.containerd.snapshotter.v1.aufs"...  error="                                                                                                                                     aufs is not supported (modprobe aufs failed: exit status 1 \"ip: can't find device 'aufs'\\nmodprobe: ca                                                                                                                                     n't change directory to '/lib/modules': No such file or directory\\n\"): skip plugin" type=io.containerd                                                                                                                                     .snapshotter.v1
INFO[2022-02-15T02:49:36.005456258Z] loading plugin "io.containerd.snapshotter.v1.btrfs"...  type=io.con                                                                                                                                     tainerd.snapshotter.v1
INFO[2022-02-15T02:49:36.008987109Z] skip loading plugin "io.containerd.snapshotter.v1.btrfs"...  error=                                                                                                                                     "path /var/lib/docker/containerd/daemon/io.containerd.snapshotter.v1.btrfs (ext4) must be a btrfs filesy                                                                                                                                     stem to be used with the btrfs snapshotter: skip plugin" type=io.containerd.snapshotter.v1
INFO[2022-02-15T02:49:36.009316898Z] loading plugin "io.containerd.snapshotter.v1.devmapper"...  type=io                                                                                                                                     .containerd.snapshotter.v1
WARN[2022-02-15T02:49:36.009666894Z] failed to load plugin io.containerd.snapshotter.v1.devmapper  error                                                                                                                                     ="devmapper not configured"
INFO[2022-02-15T02:49:36.009842570Z] loading plugin "io.containerd.snapshotter.v1.native"...  type=io.co                                                                                                                                     ntainerd.snapshotter.v1
INFO[2022-02-15T02:49:36.011774530Z] loading plugin "io.containerd.snapshotter.v1.overlayfs"...  type=io                                                                                                                                     .containerd.snapshotter.v1
INFO[2022-02-15T02:49:36.016783127Z] loading plugin "io.containerd.snapshotter.v1.zfs"...  type=io.conta                                                                                                                                     inerd.snapshotter.v1
INFO[2022-02-15T02:49:36.019013053Z] skip loading plugin "io.containerd.snapshotter.v1.zfs"...  error="p                                                                                                                                     ath /var/lib/docker/containerd/daemon/io.containerd.snapshotter.v1.zfs must be a zfs filesystem to be us                                                                                                                                     ed with the zfs snapshotter: skip plugin" type=io.containerd.snapshotter.v1
INFO[2022-02-15T02:49:36.019383518Z] loading plugin "io.containerd.metadata.v1.bolt"...  type=io.contain                                                                                                                                     erd.metadata.v1
WARN[2022-02-15T02:49:36.020814859Z] could not use snapshotter devmapper in metadata plugin  error="devm                                                                                                                                     apper not configured"
INFO[2022-02-15T02:49:36.021181522Z] metadata content store policy set             policy=shared
INFO[2022-02-15T02:49:36.067970546Z] loading plugin "io.containerd.differ.v1.walking"...  type=io.contai                                                                                                                                     nerd.differ.v1
INFO[2022-02-15T02:49:36.068350855Z] loading plugin "io.containerd.gc.v1.scheduler"...  type=io.containe                                                                                                                                     rd.gc.v1
INFO[2022-02-15T02:49:36.068947411Z] loading plugin "io.containerd.service.v1.introspection-service"...                                                                                                                                       type=io.containerd.service.v1
INFO[2022-02-15T02:49:36.069416157Z] loading plugin "io.containerd.service.v1.containers-service"...  ty                                                                                                                                     pe=io.containerd.service.v1
INFO[2022-02-15T02:49:36.069686831Z] loading plugin "io.containerd.service.v1.content-service"...  type=                                                                                                                                     io.containerd.service.v1
INFO[2022-02-15T02:49:36.069981099Z] loading plugin "io.containerd.service.v1.diff-service"...  type=io.                                                                                                                                     containerd.service.v1
INFO[2022-02-15T02:49:36.070233024Z] loading plugin "io.containerd.service.v1.images-service"...  type=i                                                                                                                                     o.containerd.service.v1
INFO[2022-02-15T02:49:36.070478073Z] loading plugin "io.containerd.service.v1.leases-service"...  type=i                                                                                                                                     o.containerd.service.v1
INFO[2022-02-15T02:49:36.070775310Z] loading plugin "io.containerd.service.v1.namespaces-service"...  ty                                                                                                                                     pe=io.containerd.service.v1
INFO[2022-02-15T02:49:36.071101505Z] loading plugin "io.containerd.service.v1.snapshots-service"...  typ                                                                                                                                     e=io.containerd.service.v1
INFO[2022-02-15T02:49:36.071411502Z] loading plugin "io.containerd.runtime.v1.linux"...  type=io.contain                                                                                                                                     erd.runtime.v1
INFO[2022-02-15T02:49:36.074161631Z] loading plugin "io.containerd.runtime.v2.task"...  type=io.containe                                                                                                                                     rd.runtime.v2
INFO[2022-02-15T02:49:36.077457068Z] loading plugin "io.containerd.monitor.v1.cgroups"...  type=io.conta                                                                                                                                     inerd.monitor.v1
INFO[2022-02-15T02:49:36.087234525Z] loading plugin "io.containerd.service.v1.tasks-service"...  type=io                                                                                                                                     .containerd.service.v1
INFO[2022-02-15T02:49:36.087607021Z] loading plugin "io.containerd.internal.v1.restart"...  type=io.cont                                                                                                                                     ainerd.internal.v1
INFO[2022-02-15T02:49:36.088260036Z] loading plugin "io.containerd.grpc.v1.containers"...  type=io.conta                                                                                                                                     inerd.grpc.v1
INFO[2022-02-15T02:49:36.088526231Z] loading plugin "io.containerd.grpc.v1.content"...  type=io.containe                                                                                                                                     rd.grpc.v1
INFO[2022-02-15T02:49:36.088810447Z] loading plugin "io.containerd.grpc.v1.diff"...  type=io.containerd.                                                                                                                                     grpc.v1
INFO[2022-02-15T02:49:36.088999508Z] loading plugin "io.containerd.grpc.v1.events"...  type=io.container                                                                                                                                     d.grpc.v1
INFO[2022-02-15T02:49:36.089189766Z] loading plugin "io.containerd.grpc.v1.healthcheck"...  type=io.cont                                                                                                                                     ainerd.grpc.v1
INFO[2022-02-15T02:49:36.089390546Z] loading plugin "io.containerd.grpc.v1.images"...  type=io.container                                                                                                                                     d.grpc.v1
INFO[2022-02-15T02:49:36.089567367Z] loading plugin "io.containerd.grpc.v1.leases"...  type=io.container                                                                                                                                     d.grpc.v1
INFO[2022-02-15T02:49:36.089773667Z] loading plugin "io.containerd.grpc.v1.namespaces"...  type=io.conta                                                                                                                                     inerd.grpc.v1
INFO[2022-02-15T02:49:36.089947051Z] loading plugin "io.containerd.internal.v1.opt"...  type=io.containe                                                                                                                                     rd.internal.v1
INFO[2022-02-15T02:49:36.096211261Z] loading plugin "io.containerd.grpc.v1.snapshots"...  type=io.contai                                                                                                                                     nerd.grpc.v1
INFO[2022-02-15T02:49:36.096841723Z] loading plugin "io.containerd.grpc.v1.tasks"...  type=io.containerd                                                                                                                                     .grpc.v1
INFO[2022-02-15T02:49:36.097078179Z] loading plugin "io.containerd.grpc.v1.version"...  type=io.containe                                                                                                                                     rd.grpc.v1
INFO[2022-02-15T02:49:36.097274167Z] loading plugin "io.containerd.grpc.v1.introspection"...  type=io.co                                                                                                                                     ntainerd.grpc.v1
INFO[2022-02-15T02:49:36.101052724Z] serving...                                    address=/var/run/dock                                                                                                                                     er/containerd/containerd-debug.sock
INFO[2022-02-15T02:49:36.102468439Z] serving...                                    address=/var/run/dock                                                                                                                                     er/containerd/containerd.sock.ttrpc
INFO[2022-02-15T02:49:36.104241130Z] serving...                                    address=/var/run/dock                                                                                                                                     er/containerd/containerd.sock
INFO[2022-02-15T02:49:36.104612637Z] containerd successfully booted in 0.593595s
INFO[2022-02-15T02:49:36.183135779Z] parsed scheme: "unix"                         module=grpc
INFO[2022-02-15T02:49:36.183403173Z] scheme "unix" not registered, fallback to default scheme  module=gr                                                                                                                                     pc
INFO[2022-02-15T02:49:36.183621764Z] ccResolverWrapper: sending update to cc: {[{unix:///var/run/docker/                                                                                                                                     containerd/containerd.sock  <nil> 0 <nil>}] <nil> <nil>}  module=grpc
INFO[2022-02-15T02:49:36.183834991Z] ClientConn switching balancer to "pick_first"  module=grpc
INFO[2022-02-15T02:49:36.193855519Z] parsed scheme: "unix"                         module=grpc
INFO[2022-02-15T02:49:36.194110048Z] scheme "unix" not registered, fallback to default scheme  module=gr                                                                                                                                     pc
INFO[2022-02-15T02:49:36.194305775Z] ccResolverWrapper: sending update to cc: {[{unix:///var/run/docker/                                                                                                                                     containerd/containerd.sock  <nil> 0 <nil>}] <nil> <nil>}  module=grpc
INFO[2022-02-15T02:49:36.194459107Z] ClientConn switching balancer to "pick_first"  module=grpc
ERRO[2022-02-15T02:49:37.531723858Z] No zfs dataset found for root                 backingFS=extfs root=                                                                                                                                     /var/lib/docker storage-driver=zfs
INFO[2022-02-15T02:49:37.880720202Z] Loading containers: start.
WARN[2022-02-15T02:49:38.369921797Z] Could not load necessary modules for IPSEC rules: protocol not supp                                                                                                                                     orted
INFO[2022-02-15T02:49:38.435573033Z] Default bridge (docker0) is assigned with an IP address 172.18.0.0/                                                                                                                                     16. Daemon option --bip can be used to set a preferred IP address
INFO[2022-02-15T02:49:38.860699575Z] Loading containers: done.
INFO[2022-02-15T02:49:39.012470546Z] Docker daemon                                 commit=459d0df graphd                                                                                                                                     river(s)=overlay2 version=20.10.12
INFO[2022-02-15T02:49:39.014457141Z] Daemon has completed initialization
INFO[2022-02-15T02:49:39.387131120Z] API listen on /var/run/docker.sock
INFO[2022-02-15T02:49:39.449190725Z] API listen on [::]:2376
